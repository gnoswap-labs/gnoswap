## start a new node
gnoland start

# Deploy package (p/)
gnokey maketx addpkg -pkgdir $WORK/pkg -pkgpath gno.land/p/test/mathpkg -gas-fee 100000ugnot -gas-wanted 30000000 -broadcast -chainid=tendermint_test test1

# Deploy realm (r/)
gnokey maketx addpkg -pkgdir $WORK/realm -pkgpath gno.land/r/test/mathrealm -gas-fee 100000ugnot -gas-wanted 30000000 -broadcast -chainid=tendermint_test test1

# Deploy caller realm
gnokey maketx addpkg -pkgdir $WORK/caller -pkgpath gno.land/r/test/caller -gas-fee 100000ugnot -gas-wanted 30000000 -broadcast -chainid=tendermint_test test1

### Baseline ###
# Empty call
gnokey maketx call -pkgpath gno.land/r/test/caller -func Empty -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:'

### Simple function (no state) ###
# Call package function (Add)
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallPkgAdd -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:'

# Call realm function (Add)
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallRealmAdd -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:'

# Inline calculation (Add)
gnokey maketx call -pkgpath gno.land/r/test/caller -func InlineAdd -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:'

### Complex function (multiple operations) ###
# Call package function (Complex)
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallPkgComplex -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:'

# Call realm function (Complex)
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallRealmComplex -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:'

# Inline calculation (Complex)
gnokey maketx call -pkgpath gno.land/r/test/caller -func InlineComplex -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:'

### Loop function ###
# Call package function (Loop 10)
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallPkgLoop10 -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:'

# Call realm function (Loop 10)
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallRealmLoop10 -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:'

# Inline loop (10)
gnokey maketx call -pkgpath gno.land/r/test/caller -func InlineLoop10 -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:'

### Loop function (larger) ###
# Call package function (Loop 100)
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallPkgLoop100 -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:'

# Call realm function (Loop 100)
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallRealmLoop100 -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:'

# Inline loop (100)
gnokey maketx call -pkgpath gno.land/r/test/caller -func InlineLoop100 -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:'

### String operation ###
# Call package function (String)
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallPkgString -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:'

# Call realm function (String)
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallRealmString -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:'

# Inline string operation
gnokey maketx call -pkgpath gno.land/r/test/caller -func InlineString -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:'

### Multiple calls ###
# Call package 5 times
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallPkg5Times -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:'

# Call realm 5 times
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallRealm5Times -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:'

### State read (realm only) ###
# Read realm state
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallRealmGetCounter -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:'

-- pkg/gnomod.toml --
module = "gno.land/p/test/mathpkg"
gno = "0.9"
-- pkg/math.gno --
package mathpkg

func Add(a, b int) int {
	return a + b
}

func Complex(a, b, c int) int {
	result := a * b
	result = result + c
	result = result / 2
	result = result % 100
	return result
}

func Loop(n int) int {
	sum := 0
	for i := 0; i < n; i++ {
		sum += i
	}
	return sum
}

func StringConcat(a, b, c string) string {
	return a + b + c
}

-- realm/gnomod.toml --
module = "gno.land/r/test/mathrealm"
gno = "0.9"
-- realm/math.gno --
package mathrealm

var counter int

func Add(a, b int) int {
	return a + b
}

func Complex(a, b, c int) int {
	result := a * b
	result = result + c
	result = result / 2
	result = result % 100
	return result
}

func Loop(n int) int {
	sum := 0
	for i := 0; i < n; i++ {
		sum += i
	}
	return sum
}

func StringConcat(a, b, c string) string {
	return a + b + c
}

func GetCounter() int {
	return counter
}

func Increment() int {
	counter++
	return counter
}

-- caller/gnomod.toml --
module = "gno.land/r/test/caller"
gno = "0.9"
-- caller/caller.gno --
package caller

import (
	"gno.land/p/test/mathpkg"
	"gno.land/r/test/mathrealm"
)

func Empty(cur realm) {
	return
}

// Simple Add
func CallPkgAdd(cur realm) int {
	return mathpkg.Add(100, 200)
}

func CallRealmAdd(cur realm) int {
	return mathrealm.Add(100, 200)
}

func InlineAdd(cur realm) int {
	return 100 + 200
}

// Complex calculation
func CallPkgComplex(cur realm) int {
	return mathpkg.Complex(10, 20, 30)
}

func CallRealmComplex(cur realm) int {
	return mathrealm.Complex(10, 20, 30)
}

func InlineComplex(cur realm) int {
	result := 10 * 20
	result = result + 30
	result = result / 2
	result = result % 100
	return result
}

// Loop
func CallPkgLoop10(cur realm) int {
	return mathpkg.Loop(10)
}

func CallRealmLoop10(cur realm) int {
	return mathrealm.Loop(10)
}

func InlineLoop10(cur realm) int {
	sum := 0
	for i := 0; i < 10; i++ {
		sum += i
	}
	return sum
}

func CallPkgLoop100(cur realm) int {
	return mathpkg.Loop(100)
}

func CallRealmLoop100(cur realm) int {
	return mathrealm.Loop(100)
}

func InlineLoop100(cur realm) int {
	sum := 0
	for i := 0; i < 100; i++ {
		sum += i
	}
	return sum
}

// String
func CallPkgString(cur realm) string {
	return mathpkg.StringConcat("Hello", "World", "!")
}

func CallRealmString(cur realm) string {
	return mathrealm.StringConcat("Hello", "World", "!")
}

func InlineString(cur realm) string {
	return "Hello" + "World" + "!"
}

// Multiple calls
func CallPkg5Times(cur realm) int {
	r := 0
	r += mathpkg.Add(1, 2)
	r += mathpkg.Add(3, 4)
	r += mathpkg.Add(5, 6)
	r += mathpkg.Add(7, 8)
	r += mathpkg.Add(9, 10)
	return r
}

func CallRealm5Times(cur realm) int {
	r := 0
	r += mathrealm.Add(1, 2)
	r += mathrealm.Add(3, 4)
	r += mathrealm.Add(5, 6)
	r += mathrealm.Add(7, 8)
	r += mathrealm.Add(9, 10)
	return r
}

// State operations (realm only)
func CallRealmGetCounter(cur realm) int {
	return mathrealm.GetCounter()
}

func CallRealmIncrement(cur realm) int {
	return mathrealm.Increment()
}

func CallRealmIncrement5Times(cur realm) int {
	r := 0
	r += mathrealm.Increment()
	r += mathrealm.Increment()
	r += mathrealm.Increment()
	r += mathrealm.Increment()
	r += mathrealm.Increment()
	return r
}
