## start a new node
gnoland start

# Deploy realm without comments
gnokey maketx addpkg -pkgdir $WORK/nocomment -pkgpath gno.land/r/test/nocomment -gas-fee 100000ugnot -gas-wanted 50000000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   328452'

# Deploy realm with comments (same logic)
gnokey maketx addpkg -pkgdir $WORK/withcomment -pkgpath gno.land/r/test/withcomment -gas-fee 100000ugnot -gas-wanted 50000000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   343204'

# Deploy realm with heavy comments (lots of comments)
gnokey maketx addpkg -pkgdir $WORK/heavycomment -pkgpath gno.land/r/test/heavycomment -gas-fee 100000ugnot -gas-wanted 50000000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   390698'

# Deploy caller realm
gnokey maketx addpkg -pkgdir $WORK/caller -pkgpath gno.land/r/test/caller -gas-fee 100000ugnot -gas-wanted 50000000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   754645'

### Call each realm to check runtime load cost ###

# Call no comment realm (single)
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallNoCommentOnce -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:   308405'

# Call with comment realm (single)
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallWithCommentOnce -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:   309863'

# Call heavy comment realm (single)
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallHeavyCommentOnce -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:   310669'

### Call twice in same transaction (cached) ###

# Call no comment realm twice in one tx
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallNoCommentTwice -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:   309915'

# Call with comment realm twice in one tx
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallWithCommentTwice -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:   311367'

# Call heavy comment realm twice in one tx
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallHeavyCommentTwice -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:   312173'

### Call 5 times in same transaction ###

# Call no comment realm 5x in one tx
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallNoComment5x -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:   314367'

# Call heavy comment realm 5x in one tx
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallHeavyComment5x -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:   316625'

### Call with comment and heavy comment ###

# Call with comment and heavy comment realm in one tx
gnokey maketx call -pkgpath gno.land/r/test/caller -func CallDiffentFunctionTwiceInSameTx -insecure-password-stdin=true -broadcast=true -chainid=tendermint_test -gas-fee 1000000ugnot -gas-wanted 1000000000 -memo "" test1
# stdout 'GAS USED:   311488'

-- nocomment/gnomod.toml --
module = "gno.land/r/test/nocomment"
gno = "0.9"
-- nocomment/main.gno --
package nocomment

func Add(a, b int) int {
	return a + b
}

func Multiply(a, b int) int {
	return a * b
}

func Subtract(a, b int) int {
	return a - b
}

func Divide(a, b int) int {
	if b == 0 {
		panic("division by zero")
	}
	return a / b
}

-- withcomment/gnomod.toml --
module = "gno.land/r/test/withcomment"
gno = "0.9"
-- withcomment/main.gno --
package withcomment

// Add adds two integers and returns the result.
// This function performs basic addition operation.
func Add(a, b int) int {
	return a + b
}

// Multiply multiplies two integers and returns the result.
// This function performs basic multiplication operation.
func Multiply(a, b int) int {
	return a * b
}

// Subtract subtracts second integer from first and returns the result.
// This function performs basic subtraction operation.
func Subtract(a, b int) int {
	return a - b
}

// Divide divides first integer by second and returns the result.
// This function performs basic division operation.
// It panics if divisor is zero.
func Divide(a, b int) int {
	if b == 0 {
		panic("division by zero")
	}
	return a / b
}

-- heavycomment/gnomod.toml --
module = "gno.land/r/test/heavycomment"
gno = "0.9"
-- heavycomment/main.gno --
// Package heavycomment provides mathematical operations with extensive documentation.
// This package is designed to test whether comments affect gas consumption.
// All functions in this package perform basic arithmetic operations.
//
// The purpose of this test is to determine if the Gno VM charges gas for
// parsing and storing comments, or if comments are stripped during compilation.
//
// If comments do affect gas, developers should be mindful of comment length
// in production contracts to optimize gas usage.
package heavycomment

// Add adds two integers and returns the result.
//
// This function takes two integer parameters and returns their sum.
// It is one of the most basic arithmetic operations available.
//
// Parameters:
//   - a: The first integer operand
//   - b: The second integer operand
//
// Returns:
//   - int: The sum of a and b
//
// Example:
//   result := Add(5, 3)  // result = 8
//
// Note: This function does not check for integer overflow.
// For large numbers, consider using a big integer library.
func Add(a, b int) int {
	return a + b
}

// Multiply multiplies two integers and returns the result.
//
// This function takes two integer parameters and returns their product.
// Multiplication is a fundamental arithmetic operation.
//
// Parameters:
//   - a: The first integer operand (multiplicand)
//   - b: The second integer operand (multiplier)
//
// Returns:
//   - int: The product of a and b
//
// Example:
//   result := Multiply(5, 3)  // result = 15
//
// Note: This function does not check for integer overflow.
// For large numbers, consider using a big integer library.
func Multiply(a, b int) int {
	return a * b
}

// Subtract subtracts the second integer from the first and returns the result.
//
// This function takes two integer parameters and returns their difference.
// The order of operands matters: a - b is not the same as b - a.
//
// Parameters:
//   - a: The integer to subtract from (minuend)
//   - b: The integer to subtract (subtrahend)
//
// Returns:
//   - int: The difference (a - b)
//
// Example:
//   result := Subtract(5, 3)  // result = 2
//
// Note: This function can return negative numbers if b > a.
func Subtract(a, b int) int {
	return a - b
}

// Divide divides the first integer by the second and returns the result.
//
// This function takes two integer parameters and returns their quotient.
// Integer division truncates toward zero.
//
// Parameters:
//   - a: The integer to be divided (dividend)
//   - b: The integer to divide by (divisor)
//
// Returns:
//   - int: The quotient of a / b
//
// Panics:
//   - If b is zero, the function panics with "division by zero"
//
// Example:
//   result := Divide(10, 3)  // result = 3 (truncated)
//
// Note: This function performs integer division. For precise division,
// consider using floating-point numbers or a decimal library.
func Divide(a, b int) int {
	// Check for division by zero to prevent runtime panic
	// This is a critical safety check that must be performed
	// before any division operation
	if b == 0 {
		panic("division by zero")
	}
	// Perform the division and return the result
	// Note: Integer division truncates toward zero
	return a / b
}

-- caller/gnomod.toml --
module = "gno.land/r/test/caller"
gno = "0.9"
-- caller/caller.gno --
package caller

import (
	"gno.land/r/test/nocomment"
	"gno.land/r/test/withcomment"
	"gno.land/r/test/heavycomment"
)

// Single calls
func CallNoCommentOnce(cur realm) {
	nocomment.Add(1, 2)
}

func CallWithCommentOnce(cur realm) {
	withcomment.Add(1, 2)
}

func CallHeavyCommentOnce(cur realm) {
	heavycomment.Add(1, 2)
}

// Double calls (same tx - test caching)
func CallNoCommentTwice(cur realm) {
	nocomment.Add(1, 2)
	nocomment.Add(3, 4)
}

func CallWithCommentTwice(cur realm) {
	withcomment.Add(1, 2)
	withcomment.Add(3, 4)
}

func CallHeavyCommentTwice(cur realm) {
	heavycomment.Add(1, 2)
	heavycomment.Add(3, 4)
}

// 5x calls (same tx)
func CallNoComment5x(cur realm) {
	nocomment.Add(1, 2)
	nocomment.Add(2, 3)
	nocomment.Add(3, 4)
	nocomment.Add(4, 5)
	nocomment.Add(5, 6)
}

func CallHeavyComment5x(cur realm) {
	heavycomment.Add(1, 2)
	heavycomment.Add(2, 3)
	heavycomment.Add(3, 4)
	heavycomment.Add(4, 5)
	heavycomment.Add(5, 6)
}

func CallDiffentFunctionTwiceInSameTx(cur realm) {
	withcomment.Add(1, 2)
	withcomment.Multiply(3, 4)
}
