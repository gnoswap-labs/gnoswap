# This test needs to be moved to the gno directory along with the contract implementation,
# as running txtar directly from the current directory is not yet supported.
#
# When running the test, place the txtar file in the `gno.land/pkg/integration/testdata` directory,
# then navigate to `integration` and run the test with `go test -v . -run TestTestdata/<file name>`.
#
# When moving the contract code, test files should not be included. This is because the `utils_test.gno` file still remains.
# The test directory configuration has been modified on the premise that it will be executed from the gno directory, not the gnoswap directory.
# The paths in `deploy.mk` are configured based on the gnoswap directory, so the contents of the two files may differ.

loadpkg gno.land/p/nt/avl
loadpkg gno.land/p/nt/ufmt
loadpkg gno.land/p/onbloc/json
loadpkg gno.land/p/nt/ownable
loadpkg gno.land/p/demo/tokens/grc20
loadpkg gno.land/p/demo/tokens/grc721
loadpkg gno.land/r/demo/defi/foo20

loadpkg gno.land/r/sys/users
loadpkg gno.land/r/gnoland/wugnot
loadpkg gno.land/r/demo/defi/grc20reg

## start a new node
gnoland start 

## deploy test-tokens

### deploy usdc
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/onbloc/usdc -pkgpath gno.land/r/onbloc/usdc -gas-fee 16818ugnot -gas-wanted 16818000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   (8|9|1[0-9])[0-9]{6}'
# stdout 'STORAGE DELTA:  (1|2)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (1|2)[0-9]{6}ugnot'

### deploy foo
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/onbloc/foo -pkgpath gno.land/r/onbloc/foo -gas-fee 16997ugnot -gas-wanted 16997000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   (8|9|1[0-9])[0-9]{6}'
# stdout 'STORAGE DELTA:  (1|2)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (1|2)[0-9]{6}ugnot'

### deploy bar
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/onbloc/bar -pkgpath gno.land/r/onbloc/bar -gas-fee 16912ugnot -gas-wanted 16912000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   (8|9|1[0-9])[0-9]{6}'
# stdout 'STORAGE DELTA:  (1|2)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (1|2)[0-9]{6}ugnot'

### deploy baz
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/onbloc/baz -pkgpath gno.land/r/onbloc/baz -gas-fee 17058ugnot -gas-wanted 17058000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   (8|9|1[0-9])[0-9]{6}'
# stdout 'STORAGE DELTA:  (1|2)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (1|2)[0-9]{6}ugnot'

### deploy qux
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/onbloc/qux -pkgpath gno.land/r/onbloc/qux -gas-fee 16914ugnot -gas-wanted 16914000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   (8|9|1[0-9])[0-9]{6}'
# stdout 'STORAGE DELTA:  (1|2)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (1|2)[0-9]{6}ugnot'

### deploy obl
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/onbloc/obl -pkgpath gno.land/r/onbloc/obl -gas-fee 17059ugnot -gas-wanted 17059000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   (8|9|1[0-9])[0-9]{6}'
# stdout 'STORAGE DELTA:  (1|2)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (1|2)[0-9]{6}ugnot'

## deploy packages

### deploy uint256
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/p/gnoswap/uint256 -pkgpath gno.land/p/gnoswap/uint256 -gas-fee 21943ugnot -gas-wanted 21943000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   (1|2)[0-9]{7}'
# stdout 'STORAGE DELTA:  (1|2)[0-9]{5} bytes'
# stdout 'STORAGE FEE:    (1|2)[0-9]{7}ugnot'

## deploy int256
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/p/gnoswap/int256 -pkgpath gno.land/p/gnoswap/int256 -gas-fee 17000ugnot -gas-wanted 17000000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   16[0-9]{6}'
# stdout 'STORAGE DELTA:  (5|6)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (5|6)[0-9]{6}ugnot'

## deploy gnsmath
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/p/gnoswap/gnsmath -pkgpath gno.land/p/gnoswap/gnsmath -gas-fee 18714ugnot -gas-wanted 18714000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   18[0-9]{6}'
# stdout 'STORAGE DELTA:  (7|8)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (7|8)[0-9]{6}ugnot'

## deploy rbac
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/p/gnoswap/rbac -pkgpath gno.land/p/gnoswap/rbac -gas-fee 11066ugnot -gas-wanted 11066000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   11[0-9]{6}'
# stdout 'STORAGE DELTA:  (4|5)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (4|5)[0-9]{6}ugnot'

## deploy store
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/p/gnoswap/store -pkgpath gno.land/p/gnoswap/store -gas-fee 12204ugnot -gas-wanted 12204000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   12[0-9]{6}'
# stdout 'STORAGE DELTA:  (3|4)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (3|4)[0-9]{6}ugnot'

## deploy version manager
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/p/gnoswap/version_manager -pkgpath gno.land/p/gnoswap/version_manager -gas-fee 13971ugnot -gas-wanted 13971000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   13[0-9]{6}'
# stdout 'STORAGE DELTA:  (1|2)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (1|2)[0-9]{6}ugnot'

## deploy realm

### deploy acccess
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/access -pkgpath gno.land/r/gnoswap/access -gas-fee 11302ugnot -gas-wanted 11302000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   11[0-9]{6}'
# stdout 'STORAGE DELTA:  (2|3)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (2|3)[0-9]{6}ugnot'

### deploy rbac realm
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/rbac -pkgpath gno.land/r/gnoswap/rbac -gas-fee 13317ugnot -gas-wanted 13317000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   13[0-9]{6}'
# stdout 'STORAGE DELTA:  (5|6)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (5|6)[0-9]{6}ugnot'

### deploy halt realm
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/halt -pkgpath gno.land/r/gnoswap/halt -gas-fee 18899ugnot -gas-wanted 18899000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   18[0-9]{6}'
# stdout 'STORAGE DELTA:  (5|6)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (5|6)[0-9]{6}ugnot'

### deploy common
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/common -pkgpath gno.land/r/gnoswap/common -gas-fee 63341ugnot -gas-wanted 63341000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   63[0-9]{6}'
# stdout 'STORAGE DELTA:  (1|2)[0-9]{5} bytes'
# stdout 'STORAGE FEE:    (1|2)[0-9]{7}ugnot'

### deploy gns
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/gns -pkgpath gno.land/r/gnoswap/gns -gas-fee 31542ugnot -gas-wanted 31542000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   31[0-9]{6}'
# stdout 'STORAGE DELTA:  (1|2)[0-9]{5} bytes'
# stdout 'STORAGE FEE:    (1|2)[0-9]{7}ugnot'

### deploy gnft
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/gnft -pkgpath gno.land/r/gnoswap/gnft -gas-fee 24703ugnot -gas-wanted 24703000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   24[0-9]{6}'
# stdout 'STORAGE DELTA:  (5|6)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (5|6)[0-9]{6}ugnot'

### deploy gov/xgns
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/gov/xgns -pkgpath gno.land/r/gnoswap/gov/xgns -gas-fee 17958ugnot -gas-wanted 17958000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   17[0-9]{6}'
# stdout 'STORAGE DELTA:  (1|2)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (1|2)[0-9]{6}ugnot'

### deploy emission
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/emission -pkgpath gno.land/r/gnoswap/emission -gas-fee 28147ugnot -gas-wanted 28147000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   26[0-9]{6}'
# stdout 'STORAGE DELTA:  (5|6)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (5|6)[0-9]{6}ugnot'

### deploy protocol_fee
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/protocol_fee -pkgpath gno.land/r/gnoswap/protocol_fee -gas-fee 17490ugnot -gas-wanted 17490000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   17[0-9]{6}'
# stdout 'STORAGE DELTA:  (6|7)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (6|7)[0-9]{6}ugnot'

### deploy pool
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/pool -pkgpath gno.land/r/gnoswap/pool -gas-fee 415440ugnot -gas-wanted 41544000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   33[0-9]{6}'
# stdout 'STORAGE DELTA:  (1|2)[0-9]{5} bytes'
# stdout 'STORAGE FEE:    (1|2)[0-9]{7}ugnot'

### deploy position
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/position -pkgpath gno.land/r/gnoswap/position -gas-fee 22718ugnot -gas-wanted 22718000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   22[0-9]{6}'
# stdout 'STORAGE DELTA:  (7|8)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (7|8)[0-9]{6}ugnot'

### deploy router
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/router -pkgpath gno.land/r/gnoswap/router -gas-fee 14450ugnot -gas-wanted 14450000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   14[0-9]{6}'
# stdout 'STORAGE DELTA:  (3|4)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (3|4)[0-9]{6}ugnot'

### deploy staker
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/staker -pkgpath gno.land/r/gnoswap/staker -gas-fee 54852ugnot -gas-wanted 54852000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   53[0-9]{6}'
# stdout 'STORAGE DELTA:  2[0-9]{5} bytes'
# stdout 'STORAGE FEE:    2[0-9]{7}ugnot'

### deploy community_pool
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/community_pool -pkgpath gno.land/r/gnoswap/community_pool -gas-fee 20950ugnot -gas-wanted 20950000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   20[0-9]{6}'
# stdout 'STORAGE DELTA:  (1|2)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (1|2)[0-9]{6}ugnot'

### deploy gov/staker
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/gov/staker -pkgpath gno.land/r/gnoswap/gov/staker -gas-fee 33080ugnot -gas-wanted 33080000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   33[0-9]{6}'
# stdout 'STORAGE DELTA:  (1|2)[0-9]{5} bytes'
# stdout 'STORAGE FEE:    (1|2)[0-9]{7}ugnot'

### deploy gov/governance
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/gov/governance -pkgpath gno.land/r/gnoswap/gov/governance -gas-fee 27293ugnot -gas-wanted 27293000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   27[0-9]{6}'
# stdout 'STORAGE DELTA:  (1|2)[0-9]{5} bytes'
# stdout 'STORAGE FEE:    (1|2)[0-9]{7}ugnot'

### deploy launchpad
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/launchpad -pkgpath gno.land/r/gnoswap/launchpad -gas-fee 29490ugnot -gas-wanted 29490000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   29[0-9]{6}'
# stdout 'STORAGE DELTA:  (1|2)[0-9]{5} bytes'
# stdout 'STORAGE FEE:    (1|2)[0-9]{7}ugnot'

### deploy referral
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/referral -pkgpath gno.land/r/gnoswap/referral -gas-fee 17054ugnot -gas-wanted 17054000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   17[0-9]{6}'
# stdout 'STORAGE DELTA:  (3|4)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (3|4)[0-9]{6}ugnot'

## deploy versioned realm (v1)

### deploy protocol_fee
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/protocol_fee/v1 -pkgpath gno.land/r/gnoswap/protocol_fee/v1 -gas-fee 38772ugnot -gas-wanted 38772000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   38[0-9]{6}'
# stdout 'STORAGE DELTA:  (7|8)[0-9]{4} bytes'
# stdout 'STORAGE FEE:    (7|8)[0-9]{6}ugnot'

### deploy pool
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/pool/v1 -pkgpath gno.land/r/gnoswap/pool/v1 -gas-fee 63147ugnot -gas-wanted 63147000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   63[0-9]{6}'
# stdout 'STORAGE DELTA:  (2|3)[0-9]{5} bytes'
# stdout 'STORAGE FEE:    (2|3)[0-9]{7}ugnot'

### deploy position
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/position/v1 -pkgpath gno.land/r/gnoswap/position/v1 -gas-fee 55800ugnot -gas-wanted 55800000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   55[0-9]{6}'
# stdout 'STORAGE DELTA:  (1|2)[0-9]{5} bytes'
# stdout 'STORAGE FEE:    (1|2)[0-9]{7}ugnot'

### deploy router
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/router/v1 -pkgpath gno.land/r/gnoswap/router/v1 -gas-fee 50914ugnot -gas-wanted 50914000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   50[0-9]{6}'
# stdout 'STORAGE DELTA:  (1|2)[0-9]{5} bytes'
# stdout 'STORAGE FEE:    (1|2)[0-9]{7}ugnot'

### deploy staker
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/staker/v1 -pkgpath gno.land/r/gnoswap/staker/v1 -gas-fee 100762ugnot -gas-wanted 100762000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   88[0-9]{6}'
# stdout 'STORAGE DELTA:  3[0-9]{5} bytes'
# stdout 'STORAGE FEE:    3[0-9]{7}ugnot'

### deploy gov/staker
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/gov/staker/v1 -pkgpath gno.land/r/gnoswap/gov/staker/v1 -gas-fee 59533ugnot -gas-wanted 59533000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   59[0-9]{6}'
# stdout 'STORAGE DELTA:  (2|3)[0-9]{5} bytes'
# stdout 'STORAGE FEE:    (2|3)[0-9]{7}ugnot'

### deploy gov/governance
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/gov/governance/v1 -pkgpath gno.land/r/gnoswap/gov/governance/v1 -gas-fee 77422ugnot -gas-wanted 77422000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   74[0-9]{6}'
# stdout 'STORAGE DELTA:  (2|3)[0-9]{5} bytes'
# stdout 'STORAGE FEE:    (2|3)[0-9]{7}ugnot'

### deploy launchpad
gnokey maketx addpkg -pkgdir ../../../examples/gno.land/r/gnoswap/launchpad/v1 -pkgpath gno.land/r/gnoswap/launchpad/v1 -gas-fee 52111ugnot -gas-wanted 52111000 -broadcast -chainid=tendermint_test test1
# stdout 'GAS USED:   52[0-9]{6}'
# stdout 'STORAGE DELTA:  (1|2)[0-9]{5} bytes'
# stdout 'STORAGE FEE:    (1|2)[0-9]{7}ugnot'
